# ğŸ“¦ serve åŒ…ä½¿ç”¨æŒ‡å—

## ğŸ¯ æ¦‚è¿°

serve åŒ…æ˜¯ä¸€ä¸ªé›¶é…ç½®çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼Œéå¸¸é€‚åˆç”¨äºå¼€å‘ç¯å¢ƒã€æ„å»ºäº§ç‰©é¢„è§ˆå’Œå¿«é€ŸåŸå‹å¼€å‘ã€‚

## âœ… å®‰è£…å®Œæˆ

```bash
# serve åŒ…å·²å®‰è£…
âœ… serve ^14.2.4

# ç›¸å…³ä¾èµ–
âœ… express ^4.21.1
âœ… cors ^2.8.5  
âœ… dotenv ^16.6.1
```

## ğŸš€ å¯ç”¨è„šæœ¬

### serve åŒ…å‘½ä»¤

```bash
# åŸºç¡€å‘½ä»¤
pnpm run serve                 # ç›´æ¥ä½¿ç”¨ serve CLI

# é™æ€æ–‡ä»¶æœåŠ¡
pnpm run serve:static         # æœåŠ¡ ./public ç›®å½• (ç«¯å£ 3001, å¯ç”¨ CORS)
pnpm run serve:dist          # æœåŠ¡æ„å»ºäº§ç‰© (ç«¯å£ 3003, SPA æ¨¡å¼)
pnpm run serve:docs          # æœåŠ¡æ–‡æ¡£æ–‡ä»¶ (ç«¯å£ 3004, SPA æ¨¡å¼)

# é«˜çº§é…ç½®
pnpm run serve:config        # ä½¿ç”¨ serve.json é…ç½®æ–‡ä»¶
pnpm run serve:https         # HTTPS æœåŠ¡å™¨ (éœ€è¦ SSL è¯ä¹¦)
```

### å†…ç½®å·¥å…·

```bash
# ä½¿ç”¨ç¤ºä¾‹å’Œä¿¡æ¯
pnpm run serve:example       # æŸ¥çœ‹ serve åŒ…ä½¿ç”¨ç¤ºä¾‹
pnpm run serve:example --info # æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

# ç®€å•é™æ€æœåŠ¡å™¨ (Node.js å†…ç½®)
pnpm run serve:simple        # å¯åŠ¨å†…ç½®é™æ€æœåŠ¡å™¨ (ç«¯å£ 3001)
pnpm run serve:simple:8080   # å¯åŠ¨å†…ç½®é™æ€æœåŠ¡å™¨ (ç«¯å£ 8080)
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
nao-todo-server/
â”œâ”€â”€ public/                  # é™æ€æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ index.html          # ä¸»é¡µæ–‡ä»¶ (å·²åˆ›å»º)
â”œâ”€â”€ serve.json              # serve é…ç½®æ–‡ä»¶ (å·²åˆ›å»º)
â””â”€â”€ scripts/
    â”œâ”€â”€ serve-example.js     # serve ä½¿ç”¨ç¤ºä¾‹ (å·²åˆ›å»º)
    â””â”€â”€ simple-static-server.js # å†…ç½®é™æ€æœåŠ¡å™¨ (å·²åˆ›å»º)
```

## âš™ï¸ é…ç½®è¯´æ˜

### serve.json é…ç½®æ–‡ä»¶

```json
{
  "public": "./public",
  "directoryListing": false,
  "rewrites": [
    {
      "source": "/api/**", 
      "destination": "http://localhost:3002/api/$1"
    }
  ],
  "headers": [
    {
      "source": "**/*",
      "headers": [
        { "key": "X-Served-By", "value": "NaoTodo-Serve" },
        { "key": "Cache-Control", "value": "public, max-age=3600" }
      ]
    }
  ]
}
```

### ç¯å¢ƒå˜é‡æ”¯æŒ

```bash
# .env æ–‡ä»¶ä¸­çš„ç›¸å…³é…ç½®
PORT=3002                    # ä¸»æœåŠ¡å™¨ç«¯å£
CORS_ORIGIN=http://localhost:5173
SSL_CERT_PATH=./certs/fullchain.pem
SSL_KEY_PATH=./certs/privkey.pem
```

## ğŸ”§ serve åŒ…ä¸»è¦åŠŸèƒ½

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- âœ… **é›¶é…ç½®**: å¼€ç®±å³ç”¨ï¼Œæ— éœ€å¤æ‚è®¾ç½®
- âœ… **SPA æ”¯æŒ**: `--single` å‚æ•°æ”¯æŒå•é¡µåº”ç”¨
- âœ… **CORS æ”¯æŒ**: `--cors` å¯ç”¨è·¨åŸŸè¯·æ±‚  
- âœ… **GZIP å‹ç¼©**: è‡ªåŠ¨å‹ç¼©é™æ€æ–‡ä»¶
- âœ… **HTTPS æ”¯æŒ**: SSL/TLS è¯ä¹¦æ”¯æŒ
- âœ… **è‡ªå®šä¹‰ç«¯å£**: `-p` å‚æ•°æŒ‡å®šç«¯å£
- âœ… **è·¯å¾„é‡å†™**: æ”¯æŒ API ä»£ç†å’Œè·¯å¾„æ˜ å°„
- âœ… **ç¼“å­˜æ§åˆ¶**: ETag å’Œ Last-Modified æ”¯æŒ

### ğŸ¯ ä½¿ç”¨åœºæ™¯

1. **å¼€å‘ç¯å¢ƒ**
   - å¿«é€Ÿå¯åŠ¨é™æ€æ–‡ä»¶æœåŠ¡
   - å‰ç«¯å¼€å‘æ—¶çš„èµ„æºæœåŠ¡
   - API Mock å’Œä»£ç†

2. **æ„å»ºé¢„è§ˆ**
   - é¢„è§ˆæ„å»ºåçš„åº”ç”¨
   - ç”Ÿäº§ç¯å¢ƒæ¨¡æ‹Ÿ
   - æ€§èƒ½æµ‹è¯•

3. **æ–‡æ¡£æœåŠ¡**
   - é¡¹ç›®æ–‡æ¡£æœ¬åœ°é¢„è§ˆ
   - API æ–‡æ¡£æœåŠ¡
   - å¼€å‘æŒ‡å—å±•ç¤º

4. **å¿«é€ŸåŸå‹**
   - å¿«é€Ÿæ­å»ºæ¼”ç¤ºç¯å¢ƒ
   - é™æ€ç½‘ç«™æ‰˜ç®¡
   - æ–‡ä»¶åˆ†äº«æœåŠ¡

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€ä½¿ç”¨

```bash
# æœåŠ¡å½“å‰ç›®å½•
serve

# æœåŠ¡æŒ‡å®šç›®å½•å’Œç«¯å£
serve ./public -p 3001

# å¯ç”¨ CORS
serve ./public -p 3001 --cors

# SPA æ¨¡å¼ (æ‰€æœ‰è·¯ç”±è¿”å› index.html)
serve ./dist -p 3000 --single
```

### 2. HTTPS æœåŠ¡

```bash
# ä½¿ç”¨ SSL è¯ä¹¦
serve ./public -p 3001 \
  --ssl-cert ./certs/cert.pem \
  --ssl-key ./certs/key.pem
```

### 3. é…ç½®æ–‡ä»¶ä½¿ç”¨

```bash
# ä½¿ç”¨ serve.json é…ç½®
serve -c serve.json

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
serve -c custom-serve.json
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£è¢«å ç”¨
```bash
Error: listen EADDRINUSE :::3001

# è§£å†³æ–¹æ¡ˆ:
# 1. æ›´æ¢ç«¯å£
serve ./public -p 3002

# 2. æŸ¥æ‰¾å¹¶ç»ˆæ­¢å ç”¨è¿›ç¨‹
lsof -i :3001
kill -9 <PID>
```

#### 2. CORS é”™è¯¯
```bash
# é—®é¢˜: è·¨åŸŸè¯·æ±‚è¢«é˜»æ­¢
# è§£å†³æ–¹æ¡ˆ: å¯ç”¨ CORS
serve ./public -p 3001 --cors
```

#### 3. SPA è·¯ç”±é—®é¢˜
```bash
# é—®é¢˜: å‰ç«¯è·¯ç”±è¿”å› 404
# è§£å†³æ–¹æ¡ˆ: å¯ç”¨ SPA æ¨¡å¼
serve ./dist -p 3000 --single
```

#### 4. æ–‡ä»¶æƒé™é—®é¢˜
```bash
# é—®é¢˜: æ— æ³•è¯»å–æ–‡ä»¶
# è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥æ–‡ä»¶æƒé™
chmod -R 755 ./public
```

## ğŸ® å¿«é€Ÿæµ‹è¯•

### 1. æµ‹è¯•é™æ€æœåŠ¡å™¨

```bash
# å¯åŠ¨ serve é™æ€æœåŠ¡å™¨
pnpm run serve:static

# è®¿é—®: http://localhost:3001
# åº”è¯¥çœ‹åˆ° NaoTodo Server é¦–é¡µ
```

### 2. æµ‹è¯•å†…ç½®æœåŠ¡å™¨

```bash  
# å¯åŠ¨ç®€å•é™æ€æœåŠ¡å™¨
pnpm run serve:simple

# è®¿é—®: http://localhost:3001
# åŠŸèƒ½ç›¸åŒä½†ä½¿ç”¨ Node.js å†…ç½®æ¨¡å—
```

### 3. æŸ¥çœ‹ä½¿ç”¨ç¤ºä¾‹

```bash
# æŸ¥çœ‹ serve åŒ…ä¿¡æ¯
pnpm run serve:example --info

# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
pnpm run serve:example --help
```

## ğŸŒŸ æœ€ä½³å®è·µ

### 1. å¼€å‘ç¯å¢ƒ
- ä½¿ç”¨ `--cors` å¯ç”¨è·¨åŸŸæ”¯æŒ
- è®¾ç½®åˆé€‚çš„ç«¯å£é¿å…å†²çª
- åˆ©ç”¨é…ç½®æ–‡ä»¶ç»Ÿä¸€ç®¡ç†

### 2. ç”Ÿäº§é¢„è§ˆ
- ä½¿ç”¨ `--single` æ”¯æŒ SPA è·¯ç”±
- å¯ç”¨ HTTPS æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒ
- é…ç½®é€‚å½“çš„ç¼“å­˜ç­–ç•¥

### 3. æ€§èƒ½ä¼˜åŒ–
- å¯ç”¨å‹ç¼© (é»˜è®¤å¼€å¯)
- è®¾ç½®åˆç†çš„ç¼“å­˜å¤´éƒ¨
- ä½¿ç”¨ CDN åˆ†å‘é™æ€èµ„æº

### 4. å®‰å…¨è€ƒè™‘
- ä¸è¦æš´éœ²æ•æ„Ÿç›®å½•
- ä½¿ç”¨ HTTPS ä¼ è¾“æ•æ„Ÿæ•°æ®
- é™åˆ¶ç›®å½•éå†åŠŸèƒ½

## ğŸ“š ç›¸å…³èµ„æº

- [serve åŒ…å®˜æ–¹æ–‡æ¡£](https://github.com/vercel/serve)
- [Express.js é™æ€æ–‡ä»¶æœåŠ¡](https://expressjs.com/en/starter/static-files.html)
- [Node.js HTTP æ¨¡å—](https://nodejs.org/api/http.html)
- [HTTPS é…ç½®æŒ‡å—](https://nodejs.org/api/https.html)

---

ğŸ‰ **serve åŒ…å·²æˆåŠŸé›†æˆåˆ° NaoTodo é¡¹ç›®ä¸­ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨å„ç§é™æ€æ–‡ä»¶æœåŠ¡åŠŸèƒ½ï¼**